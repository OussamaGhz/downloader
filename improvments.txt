Instead of removing the limit entirely, set a reasonable batch size:

MAX_FILES_PER_RUN = 100  # Process 100 files per run

batch_size = config.source.batch_size or 100  # Default 100, override via Source settings
selected_files = pending_files[:batch_size]


1. Concurrency Limits (Recommended)
 Set via Prefect CLI
 prefect concurrency-limit create telegram-scraper --limit 1
 # Or via Python API
 from prefect.client import get_client
 async with get_client() as client:
     await client.create_concurrency_limit(
         tag="telegram-scraper",
         concurrency_limit=1
     )
   
 @flow(
     name="telegram-scraper-flow",
     task_runner=ConcurrentTaskRunner(),
     tags=["telegram-scraper"]  # <-- Add this
 )
 def telegram_scraper_flow(source_id: UUID):
     # ...
    
    
Behavior: New scheduled runs wait in queue until the previous one completes.





12:00 - Source A starts (global 1/3, source-A 1/1)
12:05 - Source B starts (global 2/3, source-B 1/1) ← Parallel
12:10 - Source C starts (global 3/3, source-C 1/1) ← Parallel
12:12 - Source A (run 2) waits (source-A slot occupied, even though global has capacity)
12:15 - Source D waits (global limit reached)
12:20 - Source A (run 1) finishes (releases both slots)
12:20 - Source A (run 2) starts (acquires source-A slot)
12:20 - Source D still waits (global limit still at 3)